<!-- Drag/drop or select WooCommerce CSV export to upload.
     Preview first 10 mapped rows in table below (shows wSKU, brand, etc. after transformation).
     Adjust defaults (publish/discount) then click "Import All" to bulk-save to DB.
     Progress bar shows status; errors/warnings in red/green. -->
<div class="import-container">
  <!-- Upload Section: Drag/drop or click to select CSV -->
  <section class="upload-section">
    <h2>Import Cabinet Products from WooCommerce CSV</h2>
    <p>Upload a WooCommerce export CSV (e.g., with SKU, Name, Meta fields for brand/doorStyle, prices, dimensions).</p>

    <!-- Drag/Drop Zone: Visual feedback on hover/drop -->
    <div
      class="drop-zone"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      [class.drag-over]="isDragOver"
    >
      <input
        #fileInput
        type="file"
        accept=".csv"
        (change)="onFileUpload($event)"
        [disabled]="isParsing"
        id="csv-file"
        class="hidden-file-input"
      >
      <!-- Clickable area for file selection (triggers input click) -->
      <div
        class="drop-label"
        (click)="triggerFileSelect()"
        [class.disabled]="isParsing"
      >
        {{ isParsing ? 'Parsing...' : 'Drag & drop CSV here or click to browse' }}
      </div>
      <div *ngIf="isParsing" class="spinner">Loading...</div>
    </div>

    <!-- Defaults Form: Optional overrides for missing CSV data -->
    <form [formGroup]="importForm" class="defaults-form">
      <label>
        Default Publish:
        <input type="checkbox" formControlName="defaultPublish">
      </label>
      <label>
        Default Discount (%):
        <input type="number" formControlName="defaultDiscount" min="0" max="100">
      </label>
    </form>
  </section>

  <!-- Preview Section: Table of first 10 mapped rows -->
  <section class="preview-section" *ngIf="mappedRows.length > 0">
    <h3>Preview Mapped Data (First 10 Rows)</h3>
    <table class="preview-table">
      <thead>
      <tr>
        <th>wSKU</th>
        <th>Brand</th>
        <th>Door Style</th>
        <th>Retail Price</th>
        <th>Height (in)</th>
        <th>Width (in)</th>
        <!-- Add more headers as needed -->
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let row of previewRows; trackBy: trackById">
        <td>{{ row?.wSKU || 'N/A' }}</td>
        <td>{{ row?.brand || 'N/A' }}</td>
        <td>{{ row?.doorStyle || 'N/A' }}</td>
        <td>${{ row?.retailPrice || 'N/A' }}</td>
        <td>{{ row?.height || 'N/A' }}</td>
        <td>{{ row?.width || 'N/A' }}</td>
      </tr>
      </tbody>
    </table>
    <p>Total mappable rows: {{ mappedRows.length }} (from {{ parsedRows.length }} parsed)</p>
  </section>

  <!-- Import Button: Triggers bulk create -->
  <section class="action-section" *ngIf="mappedRows.length > 0 && !isImporting">
    <button
      (click)="onImportRows()"
      [disabled]="importForm.invalid"
      class="btn-primary"
    >
      Import {{ mappedRows.length }} Rows
    </button>
  </section>

  <!-- Progress Section: Shows during import -->
  <section class="progress-section" *ngIf="isImporting">
    <h3>Importing...</h3>
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="importProgress"></div>
    </div>
    <p>Imported: {{ importedCount }} / {{ mappedRows.length }}</p>
  </section>

  <!-- Messages: Success/Error Display -->
  <div *ngIf="successMessage" class="success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <!-- Reset Button: Clear everything -->
  <button (click)="resetState()" class="btn-secondary">Reset & Start Over</button>
</div>
